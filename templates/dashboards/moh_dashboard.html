{% extends 'base.html' %}
{% load static widget_tweaks %}

{% block title %}MOH National Dashboard - Maternal Health System{% endblock %}

{% block content %}

<div class="space-y-10">

  <!-- Page Header -->
  {% include "components/page-header.html" with 
    title="MOH National Dashboard" 
    subtitle="County & Facility Overview â€¢ Updated just now" 
  %}

  <!-- Quick Stats Row -->
  <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
    {% include "components/stat-card.html" with 
      label="Total Registered Mothers" 
      value="12,847" 
      icon="users" 
      color="emerald" 
      trend="+18% this month" 
      trend_up=True 
    %}

    {% include "components/stat-card.html" with 
      label="ANC Visits This Month" 
      value="4,392" 
      icon="calendar-check" 
      color="emerald" 
      trend="+9%" 
      trend_up=True 
    %}

    {% include "components/stat-card.html" with 
      label="Overdue Visits" 
      value="1,284" 
      icon="clock" 
      color="red" 
      trend="+5%" 
      trend_up=False 
    %}

    {% include "components/stat-card.html" with 
      label="High-Risk Pregnancies" 
      value="673" 
      icon="exclamation-triangle" 
      color="orange" 
      trend="-3%" 
      trend_up=True 
    %}
  </div>

  <!-- Messages -->
  {% if messages %}
    <div class="space-y-4">
      {% for message in messages %}
        {% include "components/alert.html" with 
          type=message.tags 
          message=message 
          dismissible=True 
        %}
      {% endfor %}
    </div>
  {% endif %}

  <!-- Main Content Grid -->
  <div class="grid grid-cols-1 gap-8 lg:grid-cols-3">

    <!-- Left + Center Column -->
    <div class="lg:col-span-2 space-y-8">

      <!-- ANC Coverage by County -->
      {% include "components/card.html" with title="ANC Coverage by County (Last 30 Days)" %}

        <div class="divide-y divide-gray-100">
          {% for county in counties %}
            <div class="flex items-center justify-between py-4 hover:bg-gray-50 transition-colors">
              <div class="font-medium text-gray-900">{{ county.name }}</div>
              <div class="flex items-center gap-6">
                <div class="text-right">
                  <div class="text-sm text-gray-500">Coverage Rate</div>
                  <div class="text-lg font-semibold text-emerald-600">{{ county.coverage }}%</div>
                </div>
                {% if county.coverage >= 80 %}
                  {% include "components/status-badge.html" with status="completed" label="On Target" %}
                {% else %}
                  {% include "components/status-badge.html" with status="overdue" label="Below Target" %}
                {% endif %}
              </div>
            </div>
          {% empty %}
            <div class="py-8 text-center text-gray-500">
              No county data available yet
            </div>
          {% endfor %}
        </div>

      {% endinclude %}

      <!-- Top Overdue Facilities Table -->
      {% include "components/table-container.html" with 
        title="Facilities with Highest Overdue Visits" 
        empty=not overdue_facilities 
        empty_message="No overdue facilities reported in the last 7 days" 
      %}

        {% block table_content %}
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3.5 text-left text-sm font-semibold text-gray-900">Facility</th>
                <th scope="col" class="px-6 py-3.5 text-left text-sm font-semibold text-gray-900">County</th>
                <th scope="col" class="px-6 py-3.5 text-left text-sm font-semibold text-gray-900">Overdue Visits</th>
                <th scope="col" class="px-6 py-3.5 text-left text-sm font-semibold text-gray-900">Last Report</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 bg-white">
              {% for facility in overdue_facilities %}
                <tr class="hover:bg-gray-50 transition-colors">
                  <td class="whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900">
                    {{ facility.name }}
                  </td>
                  <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-600">
                    {{ facility.county }}
                  </td>
                  <td class="whitespace-nowrap px-6 py-4">
                    {% include "components/status-badge.html" with status="overdue" label=facility.overdue_count %}
                  </td>
                  <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500">
                    {{ facility.last_updated|timesince }} ago
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="4" class="py-12 text-center text-gray-500">
                    No overdue facilities at this time
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endblock %}

      {% endinclude %}

    </div>

    <!-- Right Column -->
    <div class="space-y-8">

      <!-- High-Risk Pregnancies -->
      {% include "components/card.html" with title="High-Risk Pregnancies Overview" %}

        <div class="space-y-6">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-4xl font-bold text-orange-600">{{ high_risk_count|default:"673" }}</div>
              <div class="mt-1 text-sm text-gray-600">Active high-risk cases</div>
            </div>
            <div class="rounded-full bg-orange-100 p-4">
              <i class="fas fa-exclamation-triangle text-3xl text-orange-600"></i>
            </div>
          </div>
          <div class="flex items-center gap-2 text-sm text-green-600">
            <i class="fas fa-arrow-down"></i>
            <span>4% decrease from last month</span>
          </div>
        </div>

      {% endinclude %}

      <!-- Recent Activity -->
      {% include "components/card.html" with title="Recent Alerts & Activity" %}

        <div class="space-y-4 text-sm">
          <div class="flex justify-between items-start">
            <div>
              <p class="font-medium text-gray-900">New high-risk case registered</p>
              <p class="text-gray-600">Kisumu County - Facility XYZ</p>
            </div>
            <span class="text-xs text-gray-500">12 min ago</span>
          </div>
          <div class="flex justify-between items-start">
            <div>
              <p class="font-medium text-gray-900">Coverage alert issued</p>
              <p class="text-gray-600">Mandera County below 60% target</p>
            </div>
            <span class="text-xs text-gray-500">1 hour ago</span>
          </div>
        </div>

      {% endinclude %}

    </div>

  </div>

</div>

{% endblock %}