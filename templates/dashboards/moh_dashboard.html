{% extends 'base.html' %}
{% load static widget_tweaks %}

{% block title %}MOH National Dashboard - Maternal Health System{% endblock %}

{% block content %}

<div class="space-y-10">

  <!-- Page Header + Quick Filters -->
  <div class="flex flex-col gap-6 lg:flex-row lg:items-end lg:justify-between">
    {% include "components/page-header.html" with 
      title="MOH National Dashboard" 
      subtitle="Real-time Maternal Health Overview â€¢ Last updated: now" 
    %}

    {% include "components/filter-bar.html" with 
      search_form=search_form 
      status_choices=status_choices 
    %}
  </div>

  <!-- KPI Stats Grid -->
  <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">

    {% include "components/stat-card.html" with 
      label="Total Registered Mothers" 
      value=total_mothers|default:"12,847" 
      icon="users" 
      color="emerald" 
      trend="+18% this month" 
      trend_up=True 
    %}

    {% include "components/stat-card.html" with 
      label="ANC Visits (Last 30 Days)" 
      value=anc_visits_this_month|default:"4,392" 
      icon="calendar-check" 
      color="emerald" 
      trend="+9%" 
      trend_up=True 
    %}

    {% include "components/stat-card.html" with 
      label="Overdue ANC Visits" 
      value=overdue_visits|default:"1,284" 
      icon="clock" 
      color="red" 
      trend="+5%" 
      trend_up=False 
    %}

    {% include "components/stat-card.html" with 
      label="High-Risk Pregnancies" 
      value=high_risk_cases|default:"673" 
      icon="exclamation-triangle" 
      color="orange" 
      trend="-3%" 
      trend_up=True 
    %}

  </div>

  <!-- Messages -->
  {% if messages %}
    <div class="space-y-4">
      {% for message in messages %}
        {% include "components/alert.html" with 
          type=message.tags 
          message=message 
          dismissible=True 
        %}
      {% endfor %}
    </div>
  {% endif %}

  <!-- Main Content Grid -->
  <div class="grid grid-cols-1 gap-8 lg:grid-cols-3">

    <!-- Left + Center Column: Main Tables & Coverage -->
    <div class="lg:col-span-2 space-y-8">

      <!-- ANC Coverage by County -->
      {% include "components/card.html" with title="ANC Coverage by County (Last 30 Days)" %}
        {% block card_content %}
          <div class="divide-y divide-gray-100">
            <!-- Example row - replace with {% for county in counties %} -->
            <div class="flex items-center justify-between py-4 hover:bg-gray-50 transition-colors">
              <div class="font-medium text-gray-900">Nairobi County</div>
              <div class="flex items-center gap-6">
                <div class="text-right">
                  <div class="text-sm text-gray-500">Coverage Rate</div>
                  <div class="text-lg font-semibold text-emerald-600">87%</div>
                </div>
                {% include "components/status-badge.html" with status="completed" label="On Target" %}
              </div>
            </div>
            <!-- Add more rows dynamically -->
          </div>
        {% endblock %}
      {% endinclude %}

      <!-- Top Overdue Facilities Table -->
      {% include "components/table-container.html" with 
        title="Facilities with Highest Overdue Visits" 
        empty=not overdue_facilities 
        empty_message="No overdue facilities reported in the last 7 days" 
      %}
        {% block table_content %}
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3.5 text-left text-sm font-semibold text-gray-900">Facility</th>
                <th scope="col" class="px-6 py-3.5 text-left text-sm font-semibold text-gray-900">County</th>
                <th scope="col" class="px-6 py-3.5 text-left text-sm font-semibold text-gray-900">Overdue Visits</th>
                <th scope="col" class="px-6 py-3.5 text-left text-sm font-semibold text-gray-900">Last Report</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 bg-white">
              <!-- Placeholder row - replace with real loop -->
              <tr class="hover:bg-gray-50 transition-colors">
                <td class="whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900">Kenyatta National Hospital</td>
                <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-600">Nairobi</td>
                <td class="whitespace-nowrap px-6 py-4">
                  {% include "components/status-badge.html" with status="overdue" label="214" %}
                </td>
                <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500">2 hours ago</td>
              </tr>
              <!-- Repeat for real data -->
            </tbody>
          </table>
        {% endblock %}
      {% endinclude %}

    </div>

    <!-- Right Sidebar: Quick Insights -->
    <div class="space-y-8">

      <!-- High-Risk Pregnancies Summary -->
      {% include "components/card.html" with title="High-Risk Pregnancies Overview" %}
        {% block card_content %}
          <div class="space-y-6">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-4xl font-bold text-orange-600">{{ high_risk_count|default:"673" }}</div>
                <div class="text-sm text-gray-600 mt-1">Active high-risk cases</div>
              </div>
              <div class="rounded-full bg-orange-100 p-4">
                <i class="fas fa-exclamation-triangle text-3xl text-orange-600"></i>
              </div>
            </div>
            <div class="flex items-center gap-2 text-sm text-green-600">
              <i class="fas fa-arrow-down"></i>
              <span>4% decrease compared to last month</span>
            </div>
          </div>
        {% endblock %}
      {% endinclude %}

      <!-- Recent Alerts / Activity Feed -->
      {% include "components/card.html" with title="Recent Alerts & Activity" %}
        {% block card_content %}
          <div class="space-y-4 text-sm">
            <div class="flex justify-between items-start">
              <div>
                <p class="font-medium text-gray-900">New high-risk case registered</p>
                <p class="text-gray-600">Kisumu County - Facility XYZ</p>
              </div>
              <span class="text-xs text-gray-500">12 min ago</span>
            </div>
            <div class="flex justify-between items-start">
              <div>
                <p class="font-medium text-gray-900">Coverage alert</p>
                <p class="text-gray-600">Mandera County below 60% target</p>
              </div>
              <span class="text-xs text-gray-500">1 hour ago</span>
            </div>
            <!-- Add more dynamically -->
          </div>
        {% endblock %}
      {% endinclude %}

    </div>

  </div>

</div>

{% endblock %}