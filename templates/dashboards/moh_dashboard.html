{% extends 'base.html' %}
{% load static widget_tweaks %}

{% block title %}MOH National Dashboard - Maternal Health System{% endblock %}

{% block content %}

<div class="space-y-10">

  <!-- Page Header -->
  {% include "components/page-header.html" with 
    title="MOH National Dashboard" 
    subtitle="County & Facility Overview â€¢ Updated {{ last_updated|date:"H:i" }}" 
  %}

  <!-- Quick Stats Row -->
  <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
    {% include "components/stat-card.html" with 
      label="Total Registered Mothers" 
      value=total_mothers|default:"12,847" 
      icon="users" 
      color="emerald" 
      trend= mothers_trend 
      trend_up=mothers_trend_up 
    %}

    {% include "components/stat-card.html" with 
      label="ANC Visits This Month" 
      value=anc_visits_this_month|default:"4,392" 
      icon="calendar-check" 
      color="emerald" 
      trend=anc_trend 
      trend_up=anc_trend_up 
    %}

    {% include "components/stat-card.html" with 
      label="Overdue Visits" 
      value=overdue_visits|default:"1,284" 
      icon="clock" 
      color="red" 
      trend=overdue_trend 
      trend_up=overdue_trend_up 
    %}

    {% include "components/stat-card.html" with 
      label="High-Risk Pregnancies" 
      value=high_risk_pregnancies|default:"673" 
      icon="exclamation-triangle" 
      color="orange" 
      trend=high_risk_trend 
      trend_up=high_risk_trend_up 
    %}
  </div>

  <!-- Messages -->
  {% if messages %}
    <div class="space-y-4">
      {% for message in messages %}
        {% include "components/alert.html" with 
          type=message.tags 
          message=message 
          dismissible=True 
        %}
      {% endfor %}
    </div>
  {% endif %}

  <!-- Main Content Grid -->
  <div class="grid grid-cols-1 gap-8 lg:grid-cols-3">

    <!-- Left + Center Column -->
    <div class="lg:col-span-2 space-y-8">

      <!-- ANC Coverage by County -->
      {% include "components/card.html" with title="ANC Coverage by County (Last 30 Days)" %}

        <div class="divide-y divide-gray-100">
          {% for county in counties %}
            <div class="flex items-center justify-between py-4 px-4 hover:bg-gray-50 transition-colors sm:px-6">
              <div class="font-medium text-gray-900">{{ county.name }}</div>
              <div class="flex items-center gap-4 sm:gap-6">
                <div class="text-right">
                  <div class="text-sm text-gray-500">Coverage Rate</div>
                  <div class="text-lg font-semibold text-emerald-600">{{ county.coverage }}%</div>
                </div>
                {% if county.coverage >= 80 %}
                  {% include "components/status-badge.html" with status="completed" label="On Target" %}
                {% else %}
                  {% include "components/status-badge.html" with status="overdue" label="Below Target" %}
                {% endif %}
              </div>
            </div>
          {% empty %}
            <div class="py-8 text-center text-gray-500">
              No county data available yet
            </div>
          {% endfor %}
        </div>

  <!-- Top Overdue Facilities Table -->
  {% include "components/table-container.html" with 
    title="Facilities with Highest Overdue Visits" 
    empty=not overdue_facilities 
    empty_message="No overdue facilities reported in the last 7 days" 
  %}

    {% block table_content %}
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-4 py-3.5 text-left text-sm font-semibold text-gray-900 sm:px-6">Facility</th>
            <th scope="col" class="px-4 py-3.5 text-left text-sm font-semibold text-gray-900 sm:px-6">County</th>
            <th scope="col" class="px-4 py-3.5 text-left text-sm font-semibold text-gray-900 sm:px-6">Overdue Visits</th>
            <th scope="col" class="px-4 py-3.5 text-left text-sm font-semibold text-gray-900 sm:px-6">Last Report</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200 bg-white">
          {% for facility in overdue_facilities %}
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="whitespace-nowrap px-4 py-4 text-sm font-medium text-gray-900 sm:px-6">
                {{ facility.name }}
              </td>
              <td class="whitespace-nowrap px-4 py-4 text-sm text-gray-600 sm:px-6">
                {{ facility.county }}
              </td>
              <td class="whitespace-nowrap px-4 py-4 sm:px-6">
                {% include "components/status-badge.html" with status="overdue" label=facility.overdue_count %}
              </td>
              <td class="whitespace-nowrap px-4 py-4 text-sm text-gray-500 sm:px-6">
                {{ facility.last_updated|timesince }} ago
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="4" class="py-12 text-center text-gray-500">
                No overdue facilities at this time
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endblock %}

  </div>

  <!-- Right Column -->
  <div class="space-y-8">

    <!-- High-Risk Pregnancies -->
    {% include "components/card.html" with title="High-Risk Pregnancies Overview" %}

      <div class="space-y-6">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-4xl font-bold text-orange-600">{{ high_risk_count|default:"673" }}</div>
            <div class="mt-1 text-sm text-gray-600">Active high-risk cases</div>
          </div>
          <div class="rounded-full bg-orange-100 p-4">
            <i class="fas fa-exclamation-triangle text-3xl text-orange-600"></i>
          </div>
        </div>
        <div class="flex items-center gap-2 text-sm text-green-600">
          <i class="fas fa-arrow-down"></i>
          <span>4% decrease from last month</span>
        </div>
      </div>

    <!-- Recent Activity -->
    {% include "components/card.html" with title="Recent Alerts & Activity" %}

      <div class="space-y-4 text-sm">
        <div class="flex justify-between items-start">
          <div>
            <p class="font-medium text-gray-900">New high-risk case registered</p>
            <p class="text-gray-600">Kisumu County - Facility XYZ</p>
          </div>
          <span class="text-xs text-gray-500">12 min ago</span>
        </div>
        <div class="flex justify-between items-start">
          <div>
            <p class="font-medium text-gray-900">Coverage alert issued</p>
            <p class="text-gray-600">Mandera County below 60% target</p>
          </div>
          <span class="text-xs text-gray-500">1 hour ago</span>
        </div>
      </div>

  </div>

</div>

{% endblock %}