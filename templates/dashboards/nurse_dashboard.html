{% extends 'base.html' %}
{% load static widget_tweaks %}

{% block title %}Nurse Dashboard - Maternal Health System{% endblock %}

{% block content %}

<div class="space-y-10">

  <!-- Page Header -->
  {% include "components/page-header.html" with 
    title="Nurse Dashboard" 
    subtitle="Your facility overview for {{ 'now'|date:'F j, Y' }}" 
  %}

  <!-- Stat Cards -->
  <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
    {% include "components/stat-card.html" with label="Total Mothers" value=total_mothers icon="users" color="emerald" trend=mothers_trend trend_up=True %}
    {% include "components/stat-card.html" with label="Today's Visits" value=todays_visits icon="calendar-day" color="blue" trend=visits_trend trend_up=False %}
    {% include "components/stat-card.html" with label="Overdue Visits" value=overdue_visits icon="clock" color="red" trend=overdue_trend trend_up=False %}
    {% include "components/stat-card.html" with label="High-Risk Cases" value=high_risk icon="exclamation-triangle" color="orange" trend=high_risk_trend trend_up=False %}
  </div>

  <!-- Today's ANC Visits Table -->
  {% include "components/table-container.html" with title="Today's ANC Visits" empty=not todays_anc_visits %}
    {% block table_content %}
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Mother</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Visit #</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Time</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          {% for visit in todays_anc_visits %}
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 text-sm font-medium text-gray-900">{{ visit.pregnancy.mother.full_name }}</td>
              <td class="px-6 py-4 text-sm text-gray-500">{{ visit.visit_number }}</td>
              <td class="px-6 py-4 text-sm text-gray-500">{{ visit.scheduled_date|time:"g:i A" }}</td>
              <td class="px-6 py-4">
                {% include "components/status-badge.html" with status=visit.status|lower %}
              </td>
              <td class="px-6 py-4 text-sm">
                {% if not visit.attended %}
                  <a href="{% url 'mark_attended' visit.id %}" class="text-emerald-600 hover:text-emerald-900">Mark Attended</a>
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="5" class="py-12 text-center text-gray-500">No visits scheduled for today</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endblock %}
  {% endinclude %}

  <!-- Overdue Reminders Card -->
  {% include "components/card.html" with title="Overdue Reminders (Last 7 Days)" %}
    <div class="space-y-4">
      {% for reminder in overdue_reminders %}
        <div class="flex items-center justify-between py-3 border-b border-gray-200">
          <div>
            <p class="font-medium text-gray-900">{{ reminder.mother.full_name }}</p>
            <p class="text-sm text-gray-600">{{ reminder.template.name }}</p>
          </div>
          <div class="flex items-center gap-4">
            {% include "components/status-badge.html" with status="overdue" %}
            <a href="{% url 'resend_reminder' reminder.id %}" class="text-emerald-600 hover:text-emerald-900">Resend</a>
          </div>
        </div>
      {% empty %}
        <p class="py-8 text-center text-gray-500">No overdue reminders</p>
      {% endfor %}
    </div>
  {% endinclude %}

  <!-- Quick Actions -->
  {% include "components/card.html" with title="Quick Actions" %}
    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
      <a href="{% url 'mother_create' %}" class="flex items-center justify-center rounded-lg bg-emerald-50 p-6 hover:bg-emerald-100 transition">
        <i class="fas fa-plus mr-2 text-emerald-600"></i>
        Register New Mother
      </a>
      <a href="{% url 'mothers_list' %}" class="flex items-center justify-center rounded-lg bg-blue-50 p-6 hover:bg-blue-100 transition">
        <i class="fas fa-list mr-2 text-blue-600"></i>
        View All Mothers
      </a>
    </div>
  {% endinclude %}

</div>

{% endblock %}