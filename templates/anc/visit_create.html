{% extends 'base.html' %}
{% load static %}

{% block title %}Schedule ANC Visit{% endblock %}

{% block content %}

<div class="space-y-6 p-4 md:p-6 lg:p-8 max-w-4xl mx-auto">

  <!-- Page Header -->
  <div class="flex items-center gap-3 pb-6 border-b border-gray-200">
    <a href="{% url 'anc_visit_list' %}" class="text-gray-400 hover:text-gray-600">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </a>
    <div>
      <h1 class="text-2xl md:text-3xl font-bold text-gray-900 tracking-tight">
        Schedule ANC Visit
      </h1>
      <p class="mt-1.5 text-gray-600 text-sm md:text-base">
        {% if pregnancy %}
          For {{ pregnancy.mother.full_name }} • Week {{ pregnancy.gestational_age_weeks }}
        {% else %}
          Create a new antenatal care appointment
        {% endif %}
      </p>
    </div>
  </div>

  {% if pregnancy %}
  <!-- Mother & Pregnancy Summary -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="bg-blue-50 rounded-lg p-4">
      <p class="text-sm text-blue-600 font-medium">Mother</p>
      <p class="text-lg font-bold text-gray-900 mt-1">{{ pregnancy.mother.full_name }}</p>
      <p class="text-sm text-gray-600">{{ pregnancy.mother.age }} years • {{ pregnancy.mother.phone_number }}</p>
    </div>
    <div class="bg-purple-50 rounded-lg p-4">
      <p class="text-sm text-purple-600 font-medium">Gestational Age</p>
      <p class="text-lg font-bold text-gray-900 mt-1">Week {{ pregnancy.gestational_age_weeks }}</p>
      <p class="text-sm text-gray-600">EDD: {{ pregnancy.edd|date:"M d, Y" }}</p>
    </div>
    <div class="bg-emerald-50 rounded-lg p-4">
      <p class="text-sm text-emerald-600 font-medium">Previous Visits</p>
      <p class="text-lg font-bold text-gray-900 mt-1">{{ pregnancy.anc_visits.count }}</p>
      <p class="text-sm text-gray-600">G{{ pregnancy.pregnancy_number }} P{{ pregnancy.parity }}</p>
    </div>
  </div>
  {% endif %}

  <form method="post" class="space-y-6">
    {% csrf_token %}

    <!-- Mother Selection (if no pregnancy selected) -->
    {% if not pregnancy %}
    <div class="bg-amber-50 border border-amber-200 rounded-xl p-6">
      <div class="flex items-start gap-3">
        <svg class="w-6 h-6 text-amber-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <div>
          <p class="font-medium text-amber-900">Select Mother First</p>
          <p class="text-sm text-amber-700 mt-1">
            Please go to the <a href="{% url 'mother_list' %}" class="underline">mother list</a> and select a mother to schedule a visit for.
          </p>
        </div>
      </div>
    </div>
    {% else %}

    <!-- Visit Details -->
    <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-6">Visit Details</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Scheduled Date *</label>
          {{ form.scheduled_date }}
          {% if form.scheduled_date.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.scheduled_date.errors.0 }}</p>
          {% endif %}
          <p class="mt-1 text-xs text-gray-500">Select the date for this ANC visit</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Next Visit Date</label>
          {{ form.next_visit_date }}
          {% if form.next_visit_date.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.next_visit_date.errors.0 }}</p>
          {% endif %}
          <p class="mt-1 text-xs text-gray-500">Optional: Schedule the following visit now</p>
        </div>
      </div>
    </div>

    <!-- Clinical Notes (Optional) -->
    <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-6">Additional Notes (Optional)</h2>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Clinical Notes</label>
        {{ form.clinical_notes }}
        <p class="mt-1 text-xs text-gray-500">Any special instructions or notes for this visit</p>
      </div>
    </div>

    <!-- Helpful Info -->
    <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
      <div class="flex items-start gap-3">
        <svg class="w-6 h-6 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <div>
          <p class="font-medium text-blue-900">Kenya MoH 8-Contact ANC Schedule</p>
          <ul class="text-sm text-blue-700 mt-2 space-y-1 list-disc list-inside">
            <li>Contact 1: Week 10 (1st Trimester)</li>
            <li>Contact 2: Week 20 (2nd Trimester)</li>
            <li>Contact 3: Week 26 (2nd Trimester)</li>
            <li>Contact 4: Week 30 (3rd Trimester)</li>
            <li>Contact 5: Week 34 (3rd Trimester)</li>
            <li>Contact 6: Week 36 (3rd Trimester)</li>
            <li>Contact 7: Week 38 (3rd Trimester)</li>
            <li>Contact 8: Week 40 (3rd Trimester - at EDD)</li>
          </ul>
          <p class="text-sm text-blue-700 mt-2">
            <strong>Note:</strong> Visits are auto-generated when pregnancy is registered
          </p>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="flex gap-4 justify-end">
      <a href="{% url 'mother_detail' pregnancy.mother.pk %}" class="px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors">
        Cancel
      </a>
      <button type="submit" class="px-8 py-3 bg-emerald-600 text-white font-medium rounded-lg hover:bg-emerald-700 transition-colors flex items-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
        Schedule Visit
      </button>
    </div>
    {% endif %}

  </form>

</div>

{% endblock %}